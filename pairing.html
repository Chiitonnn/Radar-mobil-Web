<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appairage - Contr√¥le Servo</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body class="pairing-page">
    <div class="pairing-container">
        <div class="pairing-header">
            <h1>üîó Appairage ESP32</h1>
            <p>Canal MQTT: <strong>gay/1</strong></p>
        </div>

        <div class="pairing-steps">
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>V√©rifiez la connexion ESP32</h3>
                    <p>L'ESP32 doit √™tre connect√© au broker MQTT public</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>Topic configur√©</h3>
                    <p>L'ESP32 doit utiliser le topic: <strong>gay/1</strong></p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>D√©marrer l'appairage</h3>
                    <p>Cliquez sur le bouton ci-dessous</p>
                </div>
            </div>
        </div>

        <div class="pairing-actions">
            <button onclick="startPairingProcess()" class="btn btn-success btn-full">üîç D√©marrer l'appairage</button>
            <a href="dashboard.html" class="btn btn-primary">üì± Retour au tableau de bord</a>
            <a href="index.html" class="btn btn-secondary">üîê Retour √† la connexion</a>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/modules/radar-visualizer.js"></script>
    <script src="js/modules/device-manager.js"></script>
    <script src="js/modules/ui-manager.js"></script>
    <script src="js/app.js"></script>
    <script>
        async function startPairingProcess() {
            if (!authManager.currentUser) {
                alert('Veuillez vous connecter d\'abord');
                window.location.href = 'index.html';
                return;
            }

            try {
                const device = await authManager.startPairingProcess();
                if (device) {
                    alert(`Appareil ${device.name} appair√© avec succ√®s sur gay/1 !`);
                    window.location.href = 'dashboard.html';
                } else {
                    alert('Aucun appareil d√©tect√©. V√©rifiez la configuration ESP32.');
                }
            } catch (error) {
                alert('Erreur lors de l\'appairage: ' + error.message);
            }
        }

        // Redirection si non connect√©
        document.addEventListener('DOMContentLoaded', function() {
            if (!authManager.currentUser) {
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>